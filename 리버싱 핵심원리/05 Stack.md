# Stack
- 함수 내의 로컬 변수 임시 저장
- 함수 호출 시 파라미터 저장
- 복귀 주소 저장

스택은 위 3가지 경우에 쓰인다. 지금은 그냥 동작 원리만 알면 될 것 같다.

스택은 LIFO(Last In First Out)구조를 가진 메모리상의 구역(?)이라고 보면 된다. 4장에서 본 세그먼트 중 하나

스택은 다른 메모리 구조와 달리 낮은 주소부터 데이터가 쌓이는 것이 아니라 높은 주소부터 시작해 데이터를 넣을 수록 주소가 낮은 값으로 내려온다.

예를 들면 스택의 시작주소가 1000번지이고 1개의 데이터를 넣었다고 가정한다면 다음 데이터는 1001번지가 아닌 999번지에 쌓이게 된다.

6장에 나온 설명인데 스택을 이용해 파라미터를 전달할 경우 파라미터를 역순으로 스택에 입력한다.
그러면 해당 파라미터를 받은 함수는 스택에서 파라미터를 꺼내면 올바른 순서대로 꺼낼 수 있다.

~~근데 참조만하지 POP으로 꺼내쓰는 코드가 하나도 없던데...~~

스택의 바닥 부분은 EBP가 가리키고 있고 스택의 최상단 부분은 ESP가 가리키고 있다. 정확하게 말하면 스택 프레임이다.

스택은 PUSH, POP 명령을 통해 데이터를 입/출력할 수 있다.

PUSH EAX와 같은 명령어를 사용하면 EAX레지스터의 값을 스택에 입력할 수 있다.
POP EAX와 같은 명령어를 사용한다면 스택 최상단에 있는 데이터를 EAX레지스터로 가져올 수 있다.
그러면 자동적으로 ESP 레지스터가 왔다 갔다 하면서 바뀐다.

스택은 무조건 EAX 같이 32비트 레지스터 단위로 사용할 것이야
PUSH AH하면 AH는 16비트라 안될거야

저장도 리틀 엔디언 방식이라고 교수님이 그러셨다

### 추가 - 의문점

그런데 매개변수로 만약 구조체같은 큰 자료형을 넘겨주면 어떻게 넘어가지..

검색해보니 리턴값은 찾았다. 

- 32비트 이하 : EAX 레지스터로 리턴
- 64비트 이하 : EDX, EAX 레지스터로 리턴
- 그 이상 : 메모리상 어느 영역에 때려박고 해당 메모리 주소를 리턴

아마 매개변수도 비슷하게 굴러가지않을까 싶음

출처 : 리버싱 엔지니어링(2권 디버거 편): 윈도우 실행 파일 구조와 원리로 배우는